# Deployment of Django in Heroku

- Step 1 : Create an account in [Heroku](https://signup.heroku.com/t/platform?c=7013A000000ib1xQAA&gclid=Cj0KCQjw3s_4BRDPARIsAJsyoLMyAQ08MU3SMAOTHD-gg_kp7ypSIAR0UEnZns2VpUWm4kkUX6AyBeEaAi8UEALw_wcB)

- Step 2 : Download and install the [Heroku Command Line Interface](https://devcenter.heroku.com/articles/heroku-cli) (CLI) which makes it easy to create and manage your Heroku apps directly from the terminal. It’s an essential part of using Heroku.

- Step 3 : The Heroku CLI requires Git, the popular version control system. If you don’t already have Git installed, complete the following before installing the CLI:

    * [Git installation](https://git-scm.com/book/en/v2/Getting-Started-Installing-Git)
    * [First-time Git setup](https://git-scm.com/book/en/v2/Getting-Started-First-Time-Git-Setup)

- Step 4 :Run the command heroku on your terminal

```
$ heroku

CLI to interact with Heroku

VERSION
  heroku/7.42.4 linux-x64 node-v12.16.2

USAGE
  $ heroku [COMMAND]

COMMANDS
  access          manage user access to apps
  addons          tools and services for developing, extending, and operating your app
  apps            manage apps on Heroku
  auth            check 2fa status
  authorizations  OAuth authorizations
  autocomplete    display autocomplete installation instructions
  buildpacks      scripts used to compile apps
  certs           a topic for the ssl plugin
  ci              run an application test suite on Heroku
  clients         OAuth clients on the platform
  config          environment variables of apps
  container       Use containers to build and deploy Heroku apps
  domains         custom domains for apps
  drains          forward logs to syslog or HTTPS
  features        add/remove app features
  git             manage local git repository for app
  help            display help for heroku
  keys            add/remove account ssh keys
  labs            add/remove experimental features
  local           run Heroku app locally
  logs            display recent log output
  maintenance     enable/disable access to app
  members         manage organization members
  notifications   display notifications
  orgs            manage organizations
  pg              manage postgresql databases
  pipelines       manage pipelines
  plugins         list installed plugins
  ps              Client tools for Heroku Exec
  psql            open a psql shell to the database
  redis           manage heroku redis instances
  regions         list available regions for deployment
  releases        display the releases for an app
  reviewapps      manage reviewapps in pipelines
  run             run a one-off process inside a Heroku dyno
  sessions        OAuth sessions
  spaces          manage heroku private spaces
  status          status of the Heroku platform
  teams           manage teams
  update          update the Heroku CLI
  webhooks        list webhooks on an app

```
- Step 5 :Login to your heroku account and close the window
```
heroku login
```
- Step 6 :Install [Gunicorn](https://pypi.org/project/gunicorn/),Gunicorn ‘Green Unicorn’ is a Python WSGI HTTP Server for UNIX.The Gunicorn server is broadly compatible with various web frameworks, simply implemented, light on server resource usage, and fairly speedy .

```
pip install gunicorn
```
- Step 7 :To show the currently installed package with version run the command below
```
$ pip freeze 


Django==3.0.8
dj-database-url==0.3.0
dj-static==0.0.6
gunicorn==19.6.0
Unipath==1.0
python-decouple==3
Pillow==3.3.0
Markdown==2.6.6
bleach==1.4.3
psycopg2==2.6.1
whitenoise==3.2


```
- Step 8 :Save the currently installed package with version in  requirements.txt file

```
pip freeze > requirements.txt

```
- Step 9 : Initialized the folder in the Git repository

```
$ git init

Initialized empty Git repository in /home/steffy/Desktop/django-heroku/.git/

```
- Step 10 : Need a Gitignore file to ignore all files that don’t matter and shouldn’t be in your git repository. Think of your virtual environment and all the .pyc files. Those are both generated and can be generated by anyone that has access to your code. Therefore, it’s unnecessary to add those to your repository.Create a [.gitignore file](https://raw.githubusercontent.com/github/gitignore/master/Python.gitignore) in the folder.

- Step 11 :Add all files in the Git 
```
git add -A

```
- Step 12 : To show the current status that what all files had to be committed in the git run the command below:
```
git status

```

- Step 13 : Commit the files locally to the git
```
git commit -m "Initial Commit"

```

- Step 14 :Create an app in Heroku.If the name you had given is existing then change the name and create another name.At first I had given mypythondjangoapp as my app name , it was an existing one .Then I changed it to myawesomepythondjangoapp,it was a unique name so it had create myawesomepythondjangoapp in heroku.
```
$ heroku create mypythondjangoapp

Creating ⬢ mypythondjangoapp... !
 ▸    Name mypythondjangoapp is already taken
(venv) steffy@steffy:~/Desktop/django-heroku$ heroku create myawesomepythondjangoapp
Creating ⬢ myawesomepythondjangoapp... done
https://myawesomepythondjangoapp.herokuapp.com/ | https://git.heroku.com/myawesomepythondjangoapp.git

```
- Step 15 : Open your App in Heroku.
```
$ heroku open

```
- Step 16 :  Push the data to the git after commiting the changes.
```
git push heroku master

```

- Step 17 : When you open the app, it shows an error that static root is not set.Set Up The Static Assets.STATIC_ROOT is needed for heroku to set up the files.Go to Setting.py file in the project folder and add the STATIC_ROOT.
```
STATIC_ROOT =os.path.join(BASE_DIR,'staticfiles')

```


- Step 18 : Do the steps 11 -13 to commit the changes in the git and Push the data to the heroku master using the step 16 then run the command in Step 15.It will shows an aplication error with heroku logs --tail.Run the command below
```
$ heroku logs --tail

2020-07-13T11:33:59.006251+00:00 heroku[router]: at=error code=H14 desc="No web processes running" method=GET path="/favicon.ico" host=myawesomepythondjangoapp.herokuapp.com request_id=b308cc3e-aa77-4f5d-a9a8-b6adecd3e2fe fwd="59.99.38.203" dyno= connect= service= status=503 bytes= protocol=https


```

- Step 19 : Stop the running process using ctrl+c.No web processes is running .So Create a ProcFile in the root Folder  with no extentions.It is simply a textfile. Type the data shown below in  the Procfile.Make sure that it should be written correct!.Note it: No extra spacing sholuld be there.Here web: means the web-process type(web traffic when processed)  ,gunicorn- command needed to run the web process (python code to talk with the web process),djangoProject1-django project foldername ,wsgi-web service gateway interface.

```
web: gunicorn djangoProject1.wsgi

```

- Step 20 : Do the steps 11 -13 to commit the changes in the git and Push the data to the heroku master using the step 16 then run the command in Step 15 to open the application.It will shows an error DisallowedHost.
```
DisallowedHost at /
Invalid HTTP_HOST header: 'myawesomepythondjangoapp.herokuapp.com'. You may need to add 'myawesomepythondjangoapp.herokuapp.com' to ALLOWED_HOSTS.
Request Method:	GET
Request URL:	https://myawesomepythondjangoapp.herokuapp.com/
Django Version:	3.0.6
Exception Type:	DisallowedHost
Exception Value:	
Invalid HTTP_HOST header: 'myawesomepythondjangoapp.herokuapp.com'. You may need to add 'myawesomepythondjangoapp.herokuapp.com' to ALLOWED_HOSTS.
Exception Location:	/app/.heroku/python/lib/python3.6/site-packages/django/http/request.py in get_host, line 122
Python Executable:	/app/.heroku/python/bin/python
Python Version:	3.6.11
Python Path:	
['/app/.heroku/python/bin',
 '/app',
 '/app/.heroku/python/lib/python36.zip',
 '/app/.heroku/python/lib/python3.6',
 '/app/.heroku/python/lib/python3.6/lib-dynload',
 '/app/.heroku/python/lib/python3.6/site-packages']
Server time:	Mon, 13 Jul 2020 12:18:04 +0000


```
- Step 21 : You may need to add host address to ALLOWED_HOSTS.So go to settings.py in the project folder.there you can see ALLOWED_HOSTS = [] ,paste the app address inside it as shown below
```
ALLOWED_HOSTS = ['myawesomepythondjangoapp.herokuapp.com']

```

- Step 22 :  Do the steps 11 -13 to commit the changes in the git and Push the data to the heroku master using the step 16 then run the command in Step 15 to open the application.It will shows your website.
```
git push heroku master

```

- Step 23 :  To add the database in the heroku.Run the command below:
```
git push heroku master

```
- Step 24 :  Add a PostgreSQL database to your app in heroku.hobby-dev is a free plan in heroku.
```
$ heroku addons:create heroku-postgresql:hobby-dev

Creating postgresql-metric-21979... done, (free)
Adding postgresql-metric-21979 to myawesomepythondjangoapp... done
Setting DATABASE_URL and restarting myawesomepythondjangoapp... done, v4
Database has been created and is available

```
- Step 25 :  To automaticaly configure your  files in heroku ,install django-heroku.
```
pip install django-heroku

```
- Step 26 :  Go to settings.py and import django-heroku
```
import django_heroku


django_heroku.settings(locals())

```
- Step 27 :  Save the currently installed package with version in  requirements.txt file.
```
pip freeze > reqirements.txt

```
- Step 28 :  Do the steps 11 -13 to commit the changes in the git and Push the data to the heroku master using the step 16 then run the command in Step 15 to open the application.It will show your website.

- Step 29 :To Login in the django admin,Make migration in the heroku app.Run python manage.py migrate in heroku cli.
```
$ heroku run python manage.py migrate




Running python manage.py migrate on ⬢ myawesomepythondjangoapp... up, run.6653 (Free)
Operations to perform:
  Apply all migrations: admin, auth, contenttypes, djangoapp, sessions
Running migrations:
  Applying contenttypes.0001_initial... OK
  Applying auth.0001_initial... OK
  Applying admin.0001_initial... OK
  Applying admin.0002_logentry_remove_auto_add... OK
  Applying admin.0003_logentry_add_action_flag_choices... OK
  Applying contenttypes.0002_remove_content_type_name... OK
  Applying auth.0002_alter_permission_name_max_length... OK
  Applying auth.0003_alter_user_email_max_length... OK
  Applying auth.0004_alter_user_username_opts... OK
  Applying auth.0005_alter_user_last_login_null... OK
  Applying auth.0006_require_contenttypes_0002... OK
  Applying auth.0007_alter_validators_add_error_messages... OK
  Applying auth.0008_alter_user_username_max_length... OK
  Applying auth.0009_alter_user_last_name_max_length... OK
  Applying auth.0010_alter_group_name_max_length... OK
  Applying auth.0011_update_proxy_permissions... OK
  Applying djangoapp.0001_initial... OK
  Applying djangoapp.0002_employee... OK
  Applying djangoapp.0003_auto_20200526_1126... OK
  Applying djangoapp.0004_student_gender... OK
  Applying djangoapp.0005_registration... OK
  Applying djangoapp.0006_auto_20200608_1215... OK
  Applying djangoapp.0007_auto_20200610_1238... OK
  Applying djangoapp.0008_college_media... OK
  Applying djangoapp.0009_auto_20200615_1013... OK
  Applying djangoapp.0010_auto_20200620_0539... OK
  Applying sessions.0001_initial... OK


```
- Step 30 :To create a super user in django admin, have to move inside  the heroku machine.Run bash moves to the heroku machine which are called dianos they are  linux systems.So had to run linux commamnds inside it
```
$ heroku run bash

Running bash on ⬢ myawesomepythondjangoapp... up, run.1287 (Free)

~ $ ls

djangoapp	manage.py  Procfile	     runtime.txt djangoProject1	Media	   requirements.txt  staticfiles

~ $ python manage.py createsuperuser
Username (leave blank to use 'u33233'): admin
Email address: admin@gmail.com
Password: 
Password (again): 
Superuser created successfully.
~ $ exit
exit

```
- Step 31 :  Login  with your credentials in django admin in your heroku app.

